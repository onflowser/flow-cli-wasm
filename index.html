<html>
<head>
    <meta charset="utf-8"/>
    <script src="wasm_exec.js"></script>
    <script src="https://unpkg.com/@isomorphic-git/lightning-fs"></script>
    <script src="https://unpkg.com/isomorphic-git"></script>
    <script type="module">
        import http from 'https://unpkg.com/isomorphic-git@beta/http/web/index.js'

        const fs = new LightningFS('fs')

        window.lightningFs = fs;
        window.pfs = fs.promises;

        const dir = '/test-clone-2'
        await git.clone({
            fs,
            http,
            dir,
            url: 'https://github.com/chasefleming/fcl-next-scaffold',
            corsProxy: 'https://cors.isomorphic-git.org',
            ref: 'main',
            singleBranch: true,
            depth: 10
        })

        class FileSystem {
            constructor(fsp) {
                this.fsp = fsp;
            }

            async readFile(path) {
                console.log("readFile", path)
                const result = await this.fsp.readFile(`${dir}/${path}`, { encoding: "utf8"})
                console.log("readFile", result)
                return result;
            }

            // TODO: Implement other functions
        }

        window.flowFileSystem = new FileSystem(fs.promises)

        const go = new Go();
        WebAssembly.instantiateStreaming(fetch("flow-cli.wasm"), go.importObject).then((result) => {
            go.run(result.instance);
            console.log("GetAccount result:", window.GetAccount("0xf8d6e0586b0a20c7"))
        });
    </script>
</head>
<body></body>
</html>
